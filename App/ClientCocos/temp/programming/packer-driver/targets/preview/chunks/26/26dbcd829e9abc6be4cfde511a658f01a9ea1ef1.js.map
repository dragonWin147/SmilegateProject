{"version":3,"sources":["file:///Users/brian/Work/C++/App/ClientCocos/assets/Scripts/SocketHandler.ts"],"names":["DataLogin","DataPlayGame","_decorator","GameController","ccclass","property","errorCode","reason","token","username","METHOD","SocketHandler","websocket","getInstance","instance","connectToServer","WebSocket","onopen","console","log","onmessage","event","data","receivedData","JSON","parse","method","LOGIN","resultLogin","showError","onclose","onerror","error","sendMessage","message","readyState","OPEN","send","closeConnection","CONNECTING","close","onDestroy"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node } from 'cc';\nimport { GameController } from './GameController';\nconst { ccclass, property } = _decorator;\n\nexport class DataLogin {\n    errorCode: number;\n    reason: string;\n    token: string;\n}\n\nexport class DataPlayGame {\n    errorCode: number;\n    reason: string;\n    username: string;\n}\n\n\nexport enum METHOD {\n    LOGIN = \"LOGIN\",\n    ENTER_GAME = \"ENTER_GAME\",\n};\n\n@ccclass('SocketHandler')\nexport class SocketHandler {\n    private static instance: SocketHandler = null;\n\n    public static getInstance() {\n        if (!this.instance) {\n            this.instance = new SocketHandler();\n        }\n        return this.instance;\n    }\n\n    private websocket: WebSocket;\n\n\n    connectToServer() {\n        this.websocket = new WebSocket('ws://localhost:9002');\n\n        this.websocket.onopen = () => {\n            console.log('Connected to server');\n        };\n\n        this.websocket.onmessage = (event) => {\n            console.log('Received message:', event.data);\n            if (event.data) {\n                const receivedData = JSON.parse(event.data);\n                console.log('method', receivedData.method);\n                switch (receivedData.method) {\n                    case METHOD.LOGIN:\n                        GameController.getInstance().resultLogin(receivedData);\n                        break;\n\n                    case METHOD.LOGIN:\n                        GameController.getInstance().resultLogin(receivedData);\n                        break;\n                    default:\n                        GameController.getInstance().showError(receivedData.errorCode, receivedData.reason);\n                        break;\n                }\n            }\n        };\n\n        this.websocket.onclose = () => {\n            console.log('Disconnected from server');\n            // Xử lý khi mất kết nối\n        };\n\n        this.websocket.onerror = (error) => {\n            console.error('Error:', error);\n            // Xử lý khi có lỗi xảy ra\n        };\n    }\n\n    // Gửi tin nhắn đến server\n    sendMessage(message: string) {\n        if (this.websocket.readyState === WebSocket.OPEN) {\n            this.websocket.send(message);\n        } else {\n            console.error('WebSocket is not open');\n        }\n    }\n\n    // Đóng kết nối WebSocket\n    closeConnection() {\n        if (this.websocket.readyState === WebSocket.OPEN || this.websocket.readyState === WebSocket.CONNECTING) {\n            this.websocket.close();\n        }\n    }\n\n\n    onDestroy() {\n        this.closeConnection();\n    }\n}\n\n"]}